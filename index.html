<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>格闘技VODまとめポータル</title>
  <!-- Bootstrap CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container my-4">
    <h1 class="text-center mb-4 text-danger">格闘技VODまとめポータル</h1>

    <div id="newsAccordion" class="accordion"></div>

    <div id="loading" class="text-center text-muted">読み込み中...</div>
  </div>

  <!-- Bootstrap JS Bundle (Popper付き) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const RSS_URL = 'https://www.nikkansports.com/battle/atom.xml';
    const API_URL = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(RSS_URL)}`;

    const newsAccordion = document.getElementById('newsAccordion');
    const loading = document.getElementById('loading');

    fetch(API_URL)
      .then(res => res.json())
      .then(data => {
        loading.style.display = 'none';

        data.items.slice(0, 10).forEach((item, index) => {
          // 日付を日本語フォーマットに変換
          const pubDate = new Date(item.pubDate).toLocaleDateString('ja-JP', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          });

          // Accordion itemを作成
          const accordionItem = document.createElement('div');
          accordionItem.className = 'accordion-item';

          // ヘッダーIDとボディID（ユニークに）
          const headerId = `heading${index}`;
          const collapseId = `collapse${index}`;

          accordionItem.innerHTML = `
            <h2 class="accordion-header" id="${headerId}">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${collapseId}" aria-expanded="false" aria-controls="${collapseId}">
                ${item.title} <small class="text-muted ms-2">(${pubDate})</small>
              </button>
            </h2>
            <div id="${collapseId}" class="accordion-collapse collapse" aria-labelledby="${headerId}" data-bs-parent="#newsAccordion">
              <div class="accordion-body">
                ${item.contentSnippet ? item.contentSnippet : ''}
                <br><a href="${item.link}" target="_blank" rel="noopener noreferrer nofollow">記事を読む &raquo;</a>
              </div>
            </div>
          `;

          newsAccordion.appendChild(accordionItem);
        });
      })
      .catch(err => {
        loading.textContent = 'ニュースの読み込みに失敗しました。';
        console.error(err);
      });
  </script>
</body>
</html>
